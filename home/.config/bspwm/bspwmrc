#!/usr/bin/env sh

######################################################
##	 ▄▄▄▄     ██████  ██▓███   █     █░ ███▄ ▄███▓  
##	▓█████▄ ▒██    ▒ ▓██░  ██▒▓█░ █ ░█░▓██▒▀█▀ ██▒  
##	▒██▒ ▄██░ ▓██▄   ▓██░ ██▓▒▒█░ █ ░█ ▓██    ▓██░  
##	▒██░█▀    ▒   ██▒▒██▄█▓▒ ▒░█░ █ ░█ ▒██    ▒██   
##	░▓█  ▀█▓▒██████▒▒▒██▒ ░  ░░░██▒██▓ ▒██▒   ░██▒  
##	░▒▓███▀▒▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░░ ▓░▒ ▒  ░ ▒░   ░  ░  
##	▒░▒   ░ ░ ░▒  ░ ░░▒ ░       ▒ ░ ░  ░  ░      ░  
##	 ░    ░ ░  ░  ░  ░░         ░   ░  ░      ░     
##	 ░            ░               ░           ░     
##	      ░                                         
######################################################

## Environments.

export PATH="${PATH}:${HOME}/.config/bspwm/bin"

## Parse colors from "~/.Xresources" ---------------------------- #

xrdb -override "${HOME}/.Xresources"

xquery()
{
    [ -n "$XQUERY" ] || XQUERY="$(xrdb -query)"

    echo "$XQUERY" | while IFS= read -r STRING; do
        [ "${1}" = "${STRING%%$'\x09'*}" ] || continue
        echo "${STRING##*$'\x09'}"
        break
    done
}

getcolors()
{
    #FOREGROUND="$(xquery '*.foreground:')"
    BACKGROUND="$(xquery '*.background:')"
    #BLACK="$(xquery '*.color0:')"
    #RED="$(xquery '*.color1:')"
    #GREEN="$(xquery '*.color2:')"
    #YELLOW="$(xquery '*.color3:')"
    #BLUE="$(xquery '*.color4:')"
    #MAGENTA="$(xquery '*.color5:')"
    #CYAN="$(xquery '*.color6:')"
    #WHITE="$(xquery '*.color7:')"
}

getcolors

## Configurations ----------------------------------------------- #

workspaces()
{
    for MONITOR in $(bspc query -M); do
        name=$((name+1))
        bspc monitor ${MONITOR} -n "$name" -d '1' '2' '3' '4' '5'
    done
}

workspaces

bspc config top_padding 60
bspc config border_width 0
bspc config window_gap 10
bspc config split_ratio 0.50

bspc config focused_border_color "$BACKGROUND"
bspc config normal_border_color "$BACKGROUND"
bspc config presel_feedback_color "$BACKGROUND"

bspc config borderless_monocle true
bspc config gapless_monocle true
bspc config focus_follows_pointer true

## Window rules ------------------------------------------------- #

bspc rule -a Conky state=floating manage=off
bspc rule -a stalonetray state=floating manage=off

## Startup programs --------------------------------------------- #

# Run EWW.
eww daemon &

# Run notification daemon.
dunst --config "${HOME}/.config/dunst/dunstrc" &

# Run xsettingsd daemon.
xsettingsd &

# Run polkit daemon if doesn't started.
[ -n "$(pidof xfce-polkit)" ] || /usr/lib/xfce-polkit/xfce-polkit &

# Run keybindings daemon.
sxhkd &

# Run power manager.
xfce4-power-manager &

# Fix cursor.
xsetroot -cursor_name left_ptr

# Start X wallpaper.
feh --no-fehbg --bg-tile "${HOME}/Pictures/Wallpapers/tile_x.png"

# Run polybar.
"${HOME}/.config/polybar/launch.sh"

# Run mpd if doesn't started.
[ -n "$(pidof mpd)" ] || mpd &

# Execute bspwm-specific scripts.
bspcomp
bspfloat &
